<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Defaultzlq</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Defaultzlq">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Defaultzlq">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Defaultzlq">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Defaultzlq" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Defaultzlq</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-powershell-get-remote-users" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/22/powershell-get-remote-users/" class="article-date">
  <time datetime="2016-01-22T07:05:35.919Z" itemprop="datePublished">2016-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="title:_get_local_remote_users">title: get local remote users</h2><pre><code>[void][System.Reflection.Assembly]::LoadWithPartialName(<span class="string">"System.Drawing"</span>)
[void][System.Reflection.Assembly]::LoadWithPartialName(<span class="string">"System.Windows.Forms"</span>)

<span class="variable">$objForm</span> = New-Object System.Windows.Forms.Form
<span class="variable">$objForm</span>.Text = <span class="string">"Data Entry Form"</span>
<span class="variable">$objForm</span>.Size = New-Object System.Drawing.Size(<span class="number">210</span>, <span class="number">260</span>)
<span class="variable">$objForm</span>.StartPosition = <span class="string">"CenterScreen"</span>

<span class="variable">$OKButton</span> = New-Object System.Windows.Forms.Button
<span class="variable">$OKButton</span>.Location = New-Object System.Drawing.Size(<span class="number">10</span>, <span class="number">80</span>)
<span class="variable">$OKButton</span>.Size = New-Object System.Drawing.Size(<span class="number">180</span>, <span class="number">30</span>)
<span class="variable">$OKButton</span>.Text = <span class="string">"查看遠程桌面權限"</span>
<span class="variable">$OKButton</span>.Add_Click({
    <span class="variable">$objTextBox2</span>.Text = <span class="string">""</span>
    <span class="variable">$Computer</span> = <span class="variable">$objTextBox1</span>.Text
    if (!(Test-Connection <span class="variable">$Computer</span> -Count <span class="number">2</span> -Quiet))
    {
        <span class="variable">$objTextBox2</span>.Text = <span class="string">"$Computer 無法連接"</span>
    }
    else
    {
        <span class="variable">$adcomputer</span> = [ADSI](<span class="string">"WinNT://"</span> + <span class="variable">$Computer</span> + <span class="string">"/Remote Desktop Users,group"</span>)
        <span class="variable">$members</span> = <span class="variable">$adcomputer</span>.psbase.Invoke(<span class="string">"Members"</span>) | foreach{ ([ADSI]$<span class="number">_</span>).InvokeGet(<span class="string">"Name"</span>) }
        if (<span class="variable">$members</span> -eq <span class="variable">$null</span>)
        {
            <span class="variable">$objTextBox2</span>.Text = <span class="string">"$Computer 無遠程桌面權限"</span>
        }
        else
        {
            <span class="variable">$objTextBox2</span>.Text = <span class="string">""</span>
            <span class="variable">$nl</span> = [System.Environment]::NewLine
            foreach (<span class="variable">$user</span> in <span class="variable">$members</span>)
            {
                <span class="variable">$objTextBox2</span>.AppendText(<span class="variable">$user</span> + <span class="variable">$nl</span>)
            }
        }
    }
})
<span class="variable">$objForm</span>.Controls.Add(<span class="variable">$OKButton</span>)


<span class="variable">$objLabel</span> = New-Object System.Windows.Forms.Label
<span class="variable">$objLabel</span>.Location = New-Object System.Drawing.Size(<span class="number">10</span>, <span class="number">20</span>)
<span class="variable">$objLabel</span>.Size = New-Object System.Drawing.Size(<span class="number">180</span>, <span class="number">20</span>)
<span class="variable">$objLabel</span>.Text = <span class="string">"請在下方輸入一個電腦名稱："</span>
<span class="variable">$objForm</span>.Controls.Add(<span class="variable">$objLabel</span>)

<span class="variable">$objTextBox1</span> = New-Object System.Windows.Forms.TextBox
<span class="variable">$objTextBox1</span>.Location = New-Object System.Drawing.Size(<span class="number">10</span>, <span class="number">40</span>)
<span class="variable">$objTextBox1</span>.Size = New-Object System.Drawing.Size(<span class="number">180</span>, <span class="number">20</span>)
<span class="variable">$objForm</span>.Controls.Add(<span class="variable">$objTextBox1</span>)

<span class="variable">$objTextBox2</span> = New-Object System.Windows.Forms.TextBox
<span class="variable">$objTextBox2</span>.Location = New-Object System.Drawing.Size(<span class="number">10</span>, <span class="number">120</span>)
<span class="variable">$objTextBox2</span>.Size = New-Object System.Drawing.Size(<span class="number">180</span>, <span class="number">90</span>)
<span class="variable">$objTextBox2</span>.ScrollBars = <span class="string">'Vertical'</span>
<span class="variable">$objTextBox2</span>.Multiline = <span class="variable">$true</span>
<span class="variable">$objForm</span>.Controls.Add(<span class="variable">$objTextBox2</span>)

<span class="variable">$objForm</span>.Topmost = <span class="variable">$True</span>

<span class="variable">$objForm</span>.Add_Shown({ <span class="variable">$objForm</span>.Activate() })
[void]<span class="variable">$objForm</span>.ShowDialog()
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/22/powershell-get-remote-users/" data-id="cijpel5e80005gklac5uvlvqy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-localgpo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/localgpo/" class="article-date">
  <time datetime="2015-12-09T08:05:09.977Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>LocalGPO.msi - Excellent MS Tool<br>Microsoft_Security_Compliance_Manager_Setup.exe – The Microsoft Security Compliance Manager allows you to view, update, and export security baselines.LocalGPO.msi – This tool is designed to manage local group policies of a computer such as applying a security baseline and exporti<br>Microsoft_Security_Compliance_Manager_Setup.exe –</p>
<p>The Microsoft Security Compliance Manager allows you to view, update, and export security baselines.</p>
<p>LocalGPO.msi – This tool is designed to manage local group policies of a computer such as applying a security baseline and exporting the local Group Policy.</p>
<p>You can use a Microsoft tool called local GPO that I really like as it can do the below activities:</p>
<ol>
<li>It can backup your local GPO to a GPMC formatted backup. Which means you could backup a local GPO and then use GPMC to import it into a domain-based GPO.</li>
</ol>
<ol>
<li>It can take a GPMC backup of GP settings and import them into a local GPO on a machine.</li>
</ol>
<ol>
<li>It can restore a local GPO to its default state.</li>
</ol>
<p>Let’s take a look at how to use each function of this tool,</p>
<p>For backing up the local GPO, the syntax is simple:<br>From command-line here.cmd (open this cmd from the Local GPO folder), and simply type:<br>cscript LocalGPO.wsf /path:c:\gpbackups /export<br>Where c:\gpbackups is a path to where I want to store my backup and /export tells the script to export my local GPO settings.<br>Now if we want to import a GPMC backup or exported GP object from another stand-alone server into my local GPO, the syntax is even easier. you simply have to  provide the path to the GUID-Named folder that GPMC creates under the backup directory when you back up a GPO, like this:<br>cscript LocalGPO.wsf /path:C:\gpbackups{42ADD8FE-EDF6-479B-92C6-557343D8D091}<br>And, to restore a local GPO to its default config:<br>cscript LocalGPO.wsf /restore</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/09/localgpo/" data-id="cijpel5en0009gkla3zviip3s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-microsoft-assessment-planning" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/microsoft-assessment-planning/" class="article-date">
  <time datetime="2015-12-09T07:59:53.301Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>MAP<br>Microsoft Assessment and Planning (MAP) Toolkit<br>The Microsoft Assessment and Planning (MAP) Toolkit is an agentless inventory, assessment, and reporting tool that can securely assess IT environments for various platform migrations  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/09/microsoft-assessment-planning/" data-id="cijpel5en0008gklay2hz6mv6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sharepoint-access" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/03/sharepoint-access/" class="article-date">
  <time datetime="2015-12-03T08:49:13.832Z" itemprop="datePublished">2015-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/03/sharepoint-access/">文件馆访问权限设定</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文件馆访问的最低权限级别包括以下权限项目：<br>网站权限：检视页面、开启<br>清单权限：检视项目、检视应用程式页面  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/03/sharepoint-access/" data-id="cijpel5e80003gkla4sz3cfut" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-disable-loopback-check" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/02/disable-loopback-check/" class="article-date">
  <time datetime="2015-12-02T08:52:38.684Z" itemprop="datePublished">2015-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Disable the loopback check (less-recommended method)</p>
<p>The second method is to disable the loopback check by setting the DisableLoopbackCheck registry key.</p>
<p>To set the DisableLoopbackCheck registry key, follow these steps:<br>Set the<br>DisableStrictNameChecking<br>registry entry to 1. For more information about how to do this, click the following article number to view the article in the Microsoft Knowledge Base:<br>281308 Connecting to SMB share on a Windows 2000-based computer or a Windows Server 2003-based computer may not work with an alias name<br>Click Start, click Run, type regedit, and then click OK.<br>In Registry Editor, locate and then click the following registry key:<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa<br>Right-click Lsa, point to New, and then click DWORD Value.<br>Type DisableLoopbackCheck, and then press ENTER.<br>Right-click DisableLoopbackCheck, and then click Modify.<br>In the Value data box, type 1, and then click OK.<br>Quit Registry Editor, and then restart your computer.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/02/disable-loopback-check/" data-id="cijpel5f3000egklacj2odns7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-cannot-crawl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/02/cannot-crawl/" class="article-date">
  <time datetime="2015-12-02T08:43:34.650Z" itemprop="datePublished">2015-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hi,<br>I encountered the below error when trying to crawl the sites in SharePoint 2007.</p>
<p>Error in browser:</p>
<p>An unrecognized HTTP status was received. Check that the address can be accessed using Internet Explorer. (WebExceptionStatus ConnectionClosed The underlying connection was closed: The connection was closed unexpectedly.)</p>
<p>Event Viewer:</p>
<p>The start address <a href="http://eudnt452:14600" target="_blank" rel="external">http://eudnt452:14600</a> cannot be crawled.</p>
<p>Context: Application ‘SSP’, Catalog ‘Portal_Content’</p>
<p>Details:<br>                An unrecognized HTTP status was received. Check that the address can be accessed using Internet Explorer.   (0x80041204)</p>
<p>The update cannot be started because the content sources cannot be accessed. Fix the errors and try the update again.</p>
<p>Context: Application ‘SSP’, Catalog ‘Portal_Content’</p>
<p>Note: Sharepoint version is : 12.0.0.6514 (Aug 2009 CU)<br>THANKS in advance</p>
<p>Hi Rajesh,</p>
<p>Could you please let me know more information for further investigation?</p>
<ol>
<li>What is your farm architecture? Do you have a dedicated Index Server? Do the Query role and Index role host on the same server or separate on different server?</li>
<li>When did the issue happen? Can you remember the configuration changes before the issue happened?</li>
<li>Do you crawl a host named site? Have you disabled the loopback check?</li>
<li>Please try to capture a SPSReport on your WFEs and Application Servers and upload to the workspace.<br>Workspace URL: (<a href="https://sftasia.one.microsoft.com/ChooseTransfer.aspx?key=ff6aca11-b771-432a-bbe0-692b09f002ef" target="_blank" rel="external">https://sftasia.one.microsoft.com/ChooseTransfer.aspx?key=ff6aca11-b771-432a-bbe0-692b09f002ef</a>)<br>Workspace Password: HQtJ-mC)@G</li>
</ol>
<p>To capture SPSReports, please follow the steps:<br>1)      Download the SPSReport tool from <a href="http://spsreport.codeplex.com/" target="_blank" rel="external">http://spsreport.codeplex.com/</a><br>2)      Run the SPSReport.exe on the WFE and Application Server.<br>3)      Choose option 3 (Full).<br>4)      On your system a CAB file will be generated in the %systemroot%\SPSReports\Portal\rpt\Cab directory called %COMPUTERNAME%_SPSReports.CAB.<br>5)      The CAB file will contain the reports generated by the SPS Reporting Tool.<br>6)      Send the cab file to the workspace.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/02/cannot-crawl/" data-id="cijpel5f3000fgklaogs1hsst" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sharepoint2007" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/01/sharepoint2007/" class="article-date">
  <time datetime="2015-12-01T09:16:56.952Z" itemprop="datePublished">2015-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="title:_SharePoint_2007">title: SharePoint 2007</h2><h5 id="Microsoft_Office_SharePoint_Server_2007服务器场的初始配置包括下面的内容：">Microsoft Office SharePoint Server 2007服务器场的初始配置包括下面的内容：</h5><ul>
<li>创建服务账户  </li>
<li>启动Microsoft Office SharePoint Server 2007上的服务  </li>
<li>创建Web应用程序  </li>
<li>创建“我的站点”应用程序  </li>
<li>创建共享服务提供程序（SSP）  </li>
</ul>
<p>“服务器场搜索账户”–Office SharePoint Server搜索服务<br>“搜索服务器账户”、“内容访问账户”–Windows SharePoint Services搜索服务<br>“SSP服务凭据”和“Web应用程序池账户”</p>
<p>使用SSP可以在服务器场中共享Office SharePoint Server 2007服务<br>创建SSP之前，您必须为SSP管理网站创建Web应用程序。需要创建两个Web应用程序池  </p>
<h2 id="Office_SharePoint_Server_搜尋服務設定">Office SharePoint Server 搜尋服務設定</h2><h3 id="伺服器陣列搜尋服務帳戶">伺服器陣列搜尋服務帳戶</h3><p>將使用此帳戶執行搜尋服務。設定或變更此帳戶，會影響伺服器陣列的所有索引及查詢伺服器。</p>
<p>基於安全起見，伺服器陣列搜尋服務帳戶不可以是內建帳戶，這樣才能存取資料庫及內容索引。內建帳戶的範例為本機服務及網路服務。  </p>
<h2 id="Windows_SharePoint_Services_搜尋服務設定">Windows SharePoint Services 搜尋服務設定</h2><h3 id="服務帳戶">服務帳戶</h3><p>將使用此帳戶執行搜尋服務。</p>
<p>搜尋服務帳戶不可以是內建帳戶，這樣才能存取資料庫。內建帳戶的範例為本機服務及網路服務。 </p>
<h3 id="內容存取帳戶">內容存取帳戶</h3><p>搜尋服務將會使用此帳戶存取所有內容。</p>
<p>帳戶將會新增至「完整讀取」原則，將所有內容的唯讀存取權給與該帳戶。</p>
<p>若需適當的搜尋功能及資訊安全性，請勿使用可以修改內容的管理員帳戶。 </p>
<p>One of my customers happened to ask me if we have some set of service accounts to be created (minimal) for sharepoint deployment. Following are some of them:<br>Following are the accounts that would be required:</p>
<p>SPECIAL PERMISSION ACCOUNT:<br>(1) Setup User Account  – Used for running install and to admin server (Basically this account with do things like: Installation, Service Pack Installs, Server Maintenance, Farm Configurations, etc). Also note that this domain account has to be a LOCAL ADMIN on each every box in our Sharepoint Farm.Apart from that this account will also need DBCREATOR and SECURITYADMIN Roles on the database server.</p>
<p>GENERAL ACCOUNTS:<br>(2) Server Farm Account  – Central Admin App Pool Account, Timer Service Account. This account will be used during the installation when the installation would prompt for User Account.<br>(3) SSP App Pool Account : This is just a domain user and SharePoint would give all the required permissions to it.<br>(3) SSP Service Account – All SSP services and jobs. This could be the same account as the SSP APP POOL account.<br>(4) MOSS Search Account – Used by search service.  Also become default content access account for search. This account should only have the read access to all the web-application as it needs to crawl it.<br>(5) WSS Search Service Account– Used by the help system crawler. We will configure this service only once a day as this is really not need for anything.<br>(5) WSS Search Content Account– Used to access the data by the help system crawler. Again this can be the same account as the WSS Search Service Account.<br>(6) Application Pool Identities– The account used to access the content databases for the web app.  Also account for w3wp.exe.</p>
<p>So we created only above 6 service accounts which are all just domain users and only the (1) account is the local admin on all Sharepoint box and with some special Database roles assigned.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/01/sharepoint2007/" data-id="cijpel5ds0002gkla6h7unq60" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-user-management" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/21/user-management/" class="article-date">
  <time datetime="2015-11-21T11:49:39.009Z" itemprop="datePublished">2015-11-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/21/user-management/">User Management</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Control userpasswords2</li>
<li>gpedit.msc-→计算机配置-→WINDOWS设置-→安全设置-→本地策略-→安全选项-→网络访问: 不允许存储网络身份验证的凭据或 .NET Passports</li>
<li>gpedit.msc-→计算机配置-→Windows设置-→安全设置-→本地策略-→安全选项-→交互式登录：可被缓冲的前次登陆个数（在域控制器不可用的情况下）-→缓存10次登录<br>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\Current Version\Winlogon\<br>ValueName: CachedLogonsCount<br>Data Type: REG_SZ<br>Values: 0 - 50</li>
<li>用户在本地登录到域时，DC验证用户身份通过后，会替用户建立一个访问令牌（Access Token），其中包含着该用户的SID及用户所属所有组的SID</li>
<li>以管理员身份登录到本机，右击我的电脑–属性–高级–用户配置文件（设置）–选中刚才的测试用户配置文件–单击“复制到”，保存到一个特定的位置，并把该文件夹取名为default user</li>
<li>SID:三段数字是域的ID号，后面的ID是用户的</li>
<li>ID号是由一个叫RID操作主机的服务器来负责分发的</li>
<li>域环境下，在DC上注册acctinfo.dll动态链接库，为用户增加有关SID等信息的属性。注册命令：regsvr32 acctinfo.dll (该dll文件在Windows Resource Kit Tools内存在</li>
<li>客户端应用组策略：<br>计算机启动：刷新周期，应用计算机配置、运行启动脚本。<br>用户登录：刷新周期，应用用户设置，运行登录脚本。</li>
<li>GPO=GPC+GPT </li>
<li>组策略的应用顺序：Local—&gt;site—&gt;domain—&gt;OU—&gt;子OU</li>
<li>GPO只能链接到容器上（即LSDOU），只能对容器里面的计算机或用户生效，而对组无效</li>
<li>组策略的生效时间： a. 计算机策略设置：计算机启动、手动刷新（gpupdate /force)、90-120分钟后台周期刷新。 b. 用户策略设置：用户登录、手动刷新（gpupdate /force)、90-120分钟后台刷新。c. DC的策略设置：5分钟后台周期刷新。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/21/user-management/" data-id="cijpel5ab0001gklazyzdsbrk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-How-to-create-Hyper-V-VM-template-without-VMM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/12/How-to-create-Hyper-V-VM-template-without-VMM/" class="article-date">
  <time datetime="2015-11-12T00:55:03.528Z" itemprop="datePublished">2015-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>How to create a Hyper-V VM template without VMM</p>
<p>quickly deploy new VM’s from, without having to install and patch them each time.</p>
<ol>
<li><p>First, create a VM, install the operating system and patch it.</p>
</li>
<li><p>On your template VM browse to C:WindowsSystem32Sysprep folder, and run Sysprep. Select the option to Generalize, and select Shutdown from the drop down menu.</p>
</li>
<li><p>In the Hyper-V Manager export the VM, right click your template VM and select Export.</p>
</li>
</ol>
<p>leave the original virtual machine template in Hyper-V Manager, as every few months after more patches have been released you will want to update it and create a new template.</p>
<p> how to deploy a new virtual machine from the template. It’s not just a case of selecting Import in the Hyper-V Manager, because the exported virtual machine and it’s disks still exist and when you import a VM you don’t have the option to rename them.</p>
<ol>
<li><p>Create new VM without the disks, select New then choose Virtual Machine, configure the machine, selecting the same generation as the template you created, but CPU, memory and networking settings can be different. When you get to the Connect Virtual Hard Disk option, select Attach a virtual hard disk later, click Next and Finish.</p>
</li>
<li><p>Browse to your template VM folder (D:\Templates\Win 2012 R2 G2\Virtual Hard Disks) and copy the VHDX file locally.</p>
</li>
<li><p>Rename the copied VHDX to be the same as the virtual machine you have just created</p>
</li>
<li><p>Cut and paste the disk into the default location on your Hyper-V server for your VHDX files. </p>
</li>
<li><p>In Hyper-V Manager, right click the new VM you have deployed and select Settings, then select the SCSI Controller option (for Generation 1 virtual machines, select the IDE Controller 0). Highlight Hard Drive and click Add.</p>
</li>
<li><p>Browse to D:\Hyper-V\Virtual Hard Disks and select the VHDX file you cut and pasted earlier in step 4. Click Apply.</p>
</li>
<li><p>Now go to the Firmware option, select the hard drive you have just added and click Move Up, so it is the first boot entry. Click Apply. Click OK.</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/12/How-to-create-Hyper-V-VM-template-without-VMM/" data-id="cijpel58l0000gklaui1xc5lc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-server-2012-best-practice" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/21/server-2012-best-practice/" class="article-date">
  <time datetime="2015-10-21T08:02:11.908Z" itemprop="datePublished">2015-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="RDP_Printer_Mapping_should_be_disabled_on_hosts,_to_remove_any_chance_of_a_printer_driver_causing_instability_issues_on_the_host_machine-">RDP Printer Mapping should be disabled on hosts, to remove any chance of a printer driver causing instability issues on the host machine.</h4><p>Preferred method: Use Group Policy with host servers in their own separate OU<br>Computer Configuration –&gt; Policies –&gt; Administrative Templates –&gt; Windows Components –&gt; Remote Desktop<br>Services –&gt; Remote Desktop Session Host –&gt; Printer Redirection –&gt; Do not allow client printer redirection –&gt; Set to “Enabled  </p>
<h4 id="Default_path_for_Virtual_Hard_Disks_﴾VHD/VHDX﴿_should_be_set_to_a_non‐system_drive,_due_to_this_can_cause_disk_latency_as_well_as_create_the_potential_for_the_host_running_out_of_disk_space-">Default path for Virtual Hard Disks ﴾VHD/VHDX﴿ should be set to a non‐system drive, due to this can cause disk latency as well as create the potential for the host running out of disk space.</h4><h4 id="If_you_choose_to_save_the_VM_state_as_the_Automatic_Stop_Action,_the_default_virtual_machine_path_should_be_set_to_a_non‐system_drive,_due_to_the_creation_of_a_-bin_file_is_created_that_matches_the_size_of_memory_reserved_for_the_virtual_machine-A_-vsv_file_may_also_be_created_in_the_same_location_as_the_-bin_file,_adding_to_disk_space_used_for_each_VM-_﴾The_default_path_is:_C:\ProgramData\Microsoft\Windows\Hyper‐V-﴿">If you choose to save the VM state as the Automatic Stop Action, the default virtual machine path should be set to a non‐system drive, due to the creation of a .bin file is created that matches the size of memory reserved for the virtual machine.A .vsv file may also be created in the same location as the .bin file, adding to disk space used for each VM. ﴾The default path is: C:\ProgramData\Microsoft\Windows\Hyper‐V.﴿</h4><p>Note: Hyper‐V in Server 2012 will now only use the .bin if you choose to save the VM state as the Automatic<br>Stop Action.<br>Change to .bin usage in Server 2012: <a href="http://blogs.msdn.com/b/virtual_pc_guy/archive/2012/03/26/option‐to‐" target="_blank" rel="external">http://blogs.msdn.com/b/virtual_pc_guy/archive/2012/03/26/option‐to‐</a><br>remove‐bin‐files‐with‐hyper‐v‐in‐windows‐8.aspx</p>
<h4 id="Periodically_run_performance_counters_against_the_host,_to_ensure_optimal_performance-">Periodically run performance counters against the host, to ensure optimal performance.</h4><p>Recommend using the Hyper‐V performance counter that can be extracted from the ﴾free﴿ Codeplex PAL application:<br><a href="http://pal.codeplex.com/" target="_blank" rel="external">http://pal.codeplex.com/</a><br>Install PAL on a workstation and open it, then click on the Threshold File tab.<br>Select “Microsoft Windows Server 2012 Hyper‐V” from the Threshold file title, then choose Export to Perfmon template<br>file. Save the XML file to a location accessible to the Hyper‐V host.<br>Next, on the host, open Server Manager –&gt; Tool –&gt; Performance Monitor<br>In Performance Monitor, click on Data Collector Sets –&gt; User Defined. Right click on User Defined and choose New –&gt; Data Collector Set. Name the collector set “Hyper‐V Performance Counter Set” and select Create from a template<br>(Recommended) then choose Next. On the next screen, select Browse and then locate the XML file you exported from<br>the PAL application. Once done, this will show up in your User Defined Data Collector Sets.<br>Run these counters in Performance Monitor for 30 minutes to 1 hour ﴾during high usage times﴿ and look for disk<br>latency, memory and CPU issues, etc.</p>
<h4 id="When_creating_virtual_switches,_it_is_best_practice_to_uncheck_Allow_management_operating_system_to_share_this_network_adapter,_in_order_to_create_a_dedicated_network_for_your_VM﴾s﴿_to_communicate_with_other_computers_on_the_physical_network-_﴾If_the_management_adapter_is_shared,_do_not_modify_protocols_on_the_NIC-﴿">When creating virtual switches, it is best practice to uncheck Allow management operating system to share this network adapter, in order to create a dedicated network for your VM﴾s﴿ to communicate with other computers on the physical network. ﴾If the management adapter is shared, do not modify protocols on the NIC.﴿</h4><p>Please note: we fully support and even recommend (in some cases) using the virtual switch to separate networks for Management,<br>Live Migration, CSV/Heartbeat and even iSCSI. For example two 10GB NIC’s that are split out using VLANs and QoS</p>
<h4 id="The_recommended_minimum_free_space_on_CSV_volumes_containing_Hyper‐V_virtual_machine_VHD_and/or_VHDX_files:">The recommended minimum free space on CSV volumes containing Hyper‐V virtual machine VHD and/or VHDX files:</h4><p>15% free space, if the partition size is less than 1TB<br>10% free space, if the partition size is between 1TB and 5TB<br>5% free space, if the partition size is greater than 5TB<br>To enumerate current volume information, including the percentage free, you can use the following PowerShell command:<br>Get‐ClusterSharedVolume “Cluster Disk 1” | fc *<br>Review the “PercentageFree” output</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/21/server-2012-best-practice/" data-id="cijpel5e80004gklal62hypb0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/01/22/powershell-get-remote-users/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/12/09/localgpo/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/12/09/microsoft-assessment-planning/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/12/03/sharepoint-access/">文件馆访问权限设定</a>
          </li>
        
          <li>
            <a href="/2015/12/02/disable-loopback-check/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Defaultzlq<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>